# PR Time Tracker

PR Time Tracker is a GitHub bot that tracks core developer activity related to PRs and issues. This repository contains the user-facing part of the application. The bot's webhook handling code is located in the [pr-time-tracker-webhooks](https://github.com/holdex/pr-time-tracker-webhooks) repository.

## Contributing

If you want to contribute, please follow the Holdex [Developer Guidelines](https://github.com/holdex/developers).

## Documentation

1. Troubleshooting: [Cannot submit time](docs/cannot-submit-time/not-found.md)

## Installation

1. Visit the [PR Time Tracker App page](https://github.com/apps/pr-time-tracker) on GitHub
2. Install the app in your organization
3. Invite @pr-time-tracker to your organization and grant owner permissions
4. To manage repository access, go to "Settings" -> "GitHub Apps"

> **Important**: pr-time-tracker requires installation in a GitHub organization account to function properly. If installed in a personal account, the app will not process any data. Please ensure you install it in your organization instead.

> Optional: If you would like to have a custom tag for your organization's issues in the Holdex Project tracker, you need to add your organization's slug to the [pr-time-tracker-webhooks](https://github.com/holdex/pr-time-tracker-webhooks) repository configuration.

## User Guide

Prerequisites:

- PR Time Tracker is installed in the target repository.

### Triggering a PR time submission notice

Steps:

1. Mark the PR as Ready for review (not Draft).
2. Assign at least one reviewer.

Result:

- A PR time submission notice appears shortly after for the PR author.
- Reviewers are added to the notice after they submit a review.

### Triggering a bug submission notice

Steps:

1. Ensure the PR title starts with `fix:` (optionally with a scope like `fix(ui):`).
2. Mark the PR as Ready for review (not Draft).

Result:

- A bug submission notice appears shortly after.

Notes:

- Draft PRs do not trigger notices.

## Available Scripts

- `postinstall`: Sets up Husky for Git hooks
- `pull-env`: Pulls environment variables for development
- `dev`: Starts the development server (port 3000)
- `build`: Builds the project
- `preview`: Previews the production build
- `format`: Formats code using Prettier (with Svelte and Pug plugins)
- `lint`: Lints code using ESLint (JavaScript, TypeScript, Svelte, and CommonJS)
- `check`: Syncs SvelteKit and validates TypeScript configuration
- `type-check`: Performs TypeScript type checking
- `check:watch`: Watches for changes while checking TypeScript and syncing SvelteKit
- `proxy`: Creates an ngrok tunnel with a specific domain for development

## Local Development

### Prerequisites

1. [Git](https://git-scm.com/downloads)
2. [Node.js](https://nodejs.org/en/download/package-manager)
3. [pnpm](https://pnpm.io/installation)

### Basic Setup

1. Clone this repository
2. Install dependencies: `pnpm install`
3. Pull environment variables: `pnpm pull-env`

### Additional Configuration

The application requires two environment variables for the check-run retrigger functionality:

- `TRIGGER_SERVER_URL`
- `TRIGGER_SERVER_SECRET`

These variables are not generated by the `pull-env` script. You have two options:

1. **Full Functionality Setup**:

   - Set up [pr-time-tracker-webhooks](https://github.com/holdex/pr-time-tracker-webhooks) locally
   - Add to `.env`:
     ```
     TRIGGER_SERVER_URL=<your-local-webhook-server-url>
     TRIGGER_SERVER_SECRET=<your-local-webhook-secret>
     ```

2. **Partial Functionality Setup**:
   - Comment out the code that uses these variables if you don't need the check-run retrigger feature

### Running the Application

1. Start the proxy: `pnpm proxy` (required for GitHub login)
2. Start the development server: `pnpm dev`
3. Visit the app at `https://alert-seemingly-moccasin.ngrok-free.app`
